<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>API Endpoints</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        h1 { color: #333; }
        ul { list-style-type: none; padding: 0; }
        li { margin: 0.5em 0; }
        code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Dataanalys API v1</h1>
    <h2>Tillgängliga Endpoints</h1>
    <ul>
        <li>
            <strong>Hämta alla produkter:</strong>
            <code>GET /api/products</code>
            <p>Använd query-parametern "format" med värdet csv om du vill hämta hem produkterna i CSV-format istället.</p>
        </li>
        <li>
            <strong>Hämta alla kunder</strong>
            <code>GET /api/customers</code>
        </li>
        <li>
            <strong>Hämta en specifik kund</strong>
            <code>GET /api/customers/{id}</code>
        </li>
        <li>
            <strong>Lägg till en kund</strong>
            <code>POST /api/customers</code>
        </li>
    </ul>

    <h2>Senaste produkter</h2>
    <ul id="latest-products"></ul>
    <script>
    async function fetchAndDisplayProducts() {
        try {
            const res = await fetch('https://www.suvnet.se/api/products');
            if (!res.ok) throw new Error('Network response was not ok');
            const products = await res.json();
            // Sort by dateAdded descending
            products.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
            const latest = products.slice(0, 10);
            const ul = document.getElementById('latest-products');
            ul.innerHTML = '';
            latest.forEach(p => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <strong>${p.name}</strong> (${p.brand})<br>
                    <small>${new Date(p.dateAdded).toLocaleString()}</small><br>
                    <span>${p.description}</span><br>
                    <em>${p.price.toFixed(2)} kr</em>
                `;
                ul.appendChild(li);
            });
        } catch (e) {
            document.getElementById('latest-products').innerHTML = '<li>Kunde inte hämta produkter.</li>';
        }
    }
    fetchAndDisplayProducts();
    setInterval(fetchAndDisplayProducts, 10000);
    </script>

</body>
</html>